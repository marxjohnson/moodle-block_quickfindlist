{"version":3,"file":"quickfindlist.min.js","sources":["../src/quickfindlist.js"],"sourcesContent":["define(\n    ['jquery'],\n    function($) {\n        var priv = {\n            sesskey: null,\n            instances: []\n        };\n\n        var t = {\n            init: function(roleid, userfields, url, courseformat, courseid, sesskey) {\n                priv.sesskey = sesskey;\n\n                var instance = {\n                    'roleid': roleid,\n                    'userfields': userfields,\n                    'url': url,\n                    'courseformat': courseformat,\n                    'courseid': courseid,\n                    'progress': $('#quickfindprogress'+roleid),\n                    'listcontainer': $('#quickfindlist'+roleid),\n                    'xhr': null\n                };\n                priv.instances[roleid] = instance;\n                $('#quickfindlistsearch'+roleid).on('keyup', t.search_on_type);\n                $('#quickfindform'+roleid).on('submit', t.search_on_submit);\n            },\n\n            search_on_type: function(e) {\n                var target = $(e.target);\n                var searchstring = target.val();\n                var roleid = /[\\-0-9]+/.exec(target.attr('id'))[0];\n                t.search(searchstring, roleid);\n                M.util.js_pending('quickfindlist' + roleid);\n            },\n\n            search_on_submit: function(e) {\n                e.preventDefault();\n                var target = $(e.target);\n                var roleid = /[\\-0-9]+/.exec(target.attr('id'))[0];\n                var searchstring = target.find('#quickfindlistsearch'+roleid).val();\n                t.search(searchstring, roleid);\n                M.util.js_pending('quickfindlist' + roleid);\n            },\n\n\n            search: function(searchstring, roleid) {\n\n                var instance = priv.instances[roleid];\n\n                var url = M.cfg.wwwroot+'/blocks/quickfindlist/quickfind.php';\n                if (instance.xhr !== null) {\n                    instance.xhr.abort();\n                }\n                instance.progress.css('visibility', 'visible');\n                instance.xhr = $.ajax({\n                    url: url,\n                    data: {\n                        role: roleid,\n                        name: searchstring,\n                        courseformat: instance.courseformat,\n                        courseid: instance.courseid,\n                        sesskey: priv.sesskey\n                    }\n                }).done(function(response) {\n                    var list = $('<ul />');\n                    for (var p in response.people) {\n                        var userstring = instance.userfields.replace('[[firstname]]', response.people[p].firstname);\n                        userstring = userstring.replace('[[lastname]]', response.people[p].lastname);\n                        userstring = userstring.replace('[[username]]', response.people[p].username);\n                        var param = instance.url.includes('?') ? '&id=' : '?id=';\n                        var li = $('<li><a href=\"'+instance.url+param+response.people[p].id+'\">'+userstring+'</a></li>');\n                        list.append(li);\n                    }\n                    $('#quickfindlist'+roleid).replaceWith(list);\n                    list.attr('id', 'quickfindlist'+roleid);\n                }).fail(function(jqXHR, status) {\n                    if (status !== 'abort') {\n                        if (status !== undefined) {\n                            instance.listcontainer.html(status);\n                        }\n                    }\n                }).always(function() {\n                    instance.progress.css('visibility', 'hidden');\n                    M.util.js_complete('quickfindlist' + roleid);\n                });\n            }\n        };\n\n        return t;\n    }\n);\n"],"names":["define","$","priv","sesskey","instances","t","init","roleid","userfields","url","courseformat","courseid","instance","on","search_on_type","search_on_submit","e","target","searchstring","val","exec","attr","search","M","util","js_pending","preventDefault","find","cfg","wwwroot","xhr","abort","progress","css","ajax","data","role","name","done","response","list","p","people","userstring","replace","firstname","lastname","username","param","includes","li","id","append","replaceWith","fail","jqXHR","status","undefined","listcontainer","html","always","js_complete"],"mappings":"AAAAA,2CACI,CAAC,WACD,SAASC,OACDC,KAAO,CACPC,QAAS,KACTC,UAAW,IAGXC,EAAI,CACJC,KAAM,SAASC,OAAQC,WAAYC,IAAKC,aAAcC,SAAUR,SAC5DD,KAAKC,QAAUA,YAEXS,SAAW,QACDL,kBACIC,eACPC,iBACSC,sBACJC,kBACAV,EAAE,qBAAqBM,sBAClBN,EAAE,iBAAiBM,YAC7B,MAEXL,KAAKE,UAAUG,QAAUK,SACzBX,EAAE,uBAAuBM,QAAQM,GAAG,QAASR,EAAES,gBAC/Cb,EAAE,iBAAiBM,QAAQM,GAAG,SAAUR,EAAEU,mBAG9CD,eAAgB,SAASE,OACjBC,OAAShB,EAAEe,EAAEC,QACbC,aAAeD,OAAOE,MACtBZ,OAAS,WAAWa,KAAKH,OAAOI,KAAK,OAAO,GAChDhB,EAAEiB,OAAOJ,aAAcX,QACvBgB,EAAEC,KAAKC,WAAW,gBAAkBlB,SAGxCQ,iBAAkB,SAASC,GACvBA,EAAEU,qBACET,OAAShB,EAAEe,EAAEC,QACbV,OAAS,WAAWa,KAAKH,OAAOI,KAAK,OAAO,GAC5CH,aAAeD,OAAOU,KAAK,uBAAuBpB,QAAQY,MAC9Dd,EAAEiB,OAAOJ,aAAcX,QACvBgB,EAAEC,KAAKC,WAAW,gBAAkBlB,SAIxCe,OAAQ,SAASJ,aAAcX,YAEvBK,SAAWV,KAAKE,UAAUG,QAE1BE,IAAMc,EAAEK,IAAIC,QAAQ,sCACH,OAAjBjB,SAASkB,KACTlB,SAASkB,IAAIC,QAEjBnB,SAASoB,SAASC,IAAI,aAAc,WACpCrB,SAASkB,IAAM7B,EAAEiC,KAAK,CAClBzB,IAAKA,IACL0B,KAAM,CACFC,KAAM7B,OACN8B,KAAMnB,aACNR,aAAcE,SAASF,aACvBC,SAAUC,SAASD,SACnBR,QAASD,KAAKC,WAEnBmC,MAAK,SAASC,cACTC,KAAOvC,EAAE,cACR,IAAIwC,KAAKF,SAASG,OAAQ,KACvBC,WAAa/B,SAASJ,WAAWoC,QAAQ,gBAAiBL,SAASG,OAAOD,GAAGI,WAEjFF,YADAA,WAAaA,WAAWC,QAAQ,eAAgBL,SAASG,OAAOD,GAAGK,WAC3CF,QAAQ,eAAgBL,SAASG,OAAOD,GAAGM,cAC/DC,MAAQpC,SAASH,IAAIwC,SAAS,KAAO,OAAS,OAC9CC,GAAKjD,EAAE,gBAAgBW,SAASH,IAAIuC,MAAMT,SAASG,OAAOD,GAAGU,GAAG,KAAKR,WAAW,aACpFH,KAAKY,OAAOF,IAEhBjD,EAAE,iBAAiBM,QAAQ8C,YAAYb,MACvCA,KAAKnB,KAAK,KAAM,gBAAgBd,WACjC+C,MAAK,SAASC,MAAOC,QACL,UAAXA,aACeC,IAAXD,QACA5C,SAAS8C,cAAcC,KAAKH,WAGrCI,QAAO,WACNhD,SAASoB,SAASC,IAAI,aAAc,UACpCV,EAAEC,KAAKqC,YAAY,gBAAkBtD,oBAK1CF"}