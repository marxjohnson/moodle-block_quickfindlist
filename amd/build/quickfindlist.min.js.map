{"version":3,"sources":["../src/quickfindlist.js"],"names":["define","$","priv","sesskey","instances","loginasurl","t","init","roleid","userfields","url","courseformat","courseid","instance","on","search_on_type","search_on_submit","e","target","searchstring","val","exec","attr","search","M","util","js_pending","preventDefault","find","cfg","wwwroot","xhr","abort","progress","css","ajax","data","role","name","done","response","list","p","people","userstring","replace","firstname","lastname","username","loginas","id","li","append","replaceWith","fail","jqXHR","status","listcontainer","html","always","js_complete"],"mappings":"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","sourcesContent":["define(\n    ['jquery'],\n    function($) {\n        var priv = {\n            sesskey: null,\n            instances: [],\n            loginasurl: ''\n        };\n\n        var t = {\n            init: function(roleid, userfields, url, courseformat, courseid, sesskey, loginasurl) {\n                priv.sesskey = sesskey;\n                priv.loginasurl = loginasurl;\n\n                var instance = {\n                    'roleid': roleid,\n                    'userfields': userfields,\n                    'url': url,\n                    'courseformat': courseformat,\n                    'courseid': courseid,\n                    'progress': $('#quickfindprogress'+roleid),\n                    'listcontainer': $('#quickfindlist'+roleid),\n                    'xhr': null\n                };\n                priv.instances[roleid] = instance;\n                $('#quickfindlistsearch'+roleid).on('keyup', t.search_on_type);\n                $('#quickfindform'+roleid).on('submit', t.search_on_submit);\n            },\n\n            search_on_type: function(e) {\n                var target = $(e.target);\n                var searchstring = target.val();\n                var roleid = /[\\-0-9]+/.exec(target.attr('id'))[0];\n                t.search(searchstring, roleid);\n                M.util.js_pending('quickfindlist' + roleid);\n            },\n\n            search_on_submit: function(e) {\n                e.preventDefault();\n                var target = $(e.target);\n                var roleid = /[\\-0-9]+/.exec(target.attr('id'))[0];\n                var searchstring = target.find('#quickfindlistsearch'+roleid).val();\n                t.search(searchstring, roleid);\n                M.util.js_pending('quickfindlist' + roleid);\n            },\n\n\n            search: function(searchstring, roleid) {\n\n                var instance = priv.instances[roleid];\n\n                var url = M.cfg.wwwroot+'/blocks/quickfindlist/quickfind.php';\n                if (instance.xhr !== null) {\n                    instance.xhr.abort();\n                }\n                instance.progress.css('visibility', 'visible');\n                instance.xhr = $.ajax({\n                    url: url,\n                    data: {\n                        role: roleid,\n                        name: searchstring,\n                        courseformat: instance.courseformat,\n                        courseid: instance.courseid,\n                        sesskey: priv.sesskey\n                    }\n                }).done(function(response) {\n                    var list = $('<ul />');\n                    for (var p in response.people) {\n                        var userstring = instance.userfields.replace('[[firstname]]', response.people[p].firstname);\n                        userstring = userstring.replace('[[lastname]]', response.people[p].lastname);\n                        userstring = userstring.replace('[[username]]', response.people[p].username);\n                        if (priv.loginasurl !== '') {\n                            var loginas = '<a href=\"' + priv.loginasurl + '&user=' + response.people[p].id + '&sesskey=' +\n                                priv.sesskey + '\"><i class=\"fa fa-user\"></i></a>';\n                        } else {\n                            loginas = '';\n                        }\n                        var li = $('<li><a href=\"' + instance.url + '&id=' + response.people[p].id + '\">' + userstring +\n                            '</a> ' + loginas + '</li>');\n                        list.append(li);\n                    }\n                    $('#quickfindlist'+roleid).replaceWith(list);\n                    list.attr('id', 'quickfindlist'+roleid);\n                }).fail(function(jqXHR, status) {\n                    if (status !== 'abort') {\n                        if (status !== undefined) {\n                            instance.listcontainer.html(status);\n                        }\n                    }\n                }).always(function() {\n                    instance.progress.css('visibility', 'hidden');\n                    M.util.js_complete('quickfindlist' + roleid);\n                });\n            }\n        };\n\n        return t;\n    }\n);\n"],"file":"quickfindlist.min.js"}