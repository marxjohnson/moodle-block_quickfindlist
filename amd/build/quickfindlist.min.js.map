{"version":3,"file":"quickfindlist.min.js","sources":["../src/quickfindlist.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\nimport Pending from 'core/pending';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport Fetch from 'core/fetch';\n\n/**\n * @var {Element} blockinstance\n */\nlet blockinstance;\n\nlet currentRequest;\n\n/**\n * Return list of users\n * @param {Number} blockinstanceid\n * @param {String} search\n * @return {Promise}\n */\nexport const getUserPreferences = async(blockinstanceid, search) => {\n    const endpoint = [blockinstanceid, 'users'];\n    const request = Fetch.performGet('block_quickfindlist', endpoint.join('/'), {params: {search}});\n    currentRequest = request;\n    const response = await request;\n    if (request !== currentRequest) {\n        // Too late, there's a new request in town.\n        return null;\n    }\n    return response.json();\n};\n\nconst search = async(roleid, search) => {\n    const pending = new Pending(`quickfindlist${roleid}`);\n    const progress = blockinstance.querySelector('.quickfindprogress');\n    try {\n        progress.style.visibility = 'visible';\n        const results = await getUserPreferences(blockinstance.dataset.instanceId, search);\n        if (!results) {\n            return pending.resolve();\n        }\n        const {html, js} = await Templates.renderForPromise('block_quickfindlist/results', results);\n        Templates.replaceNode(blockinstance.querySelector('.quickfindlistresults'), html, js);\n        progress.style.visibility = 'hidden';\n    } catch (e) {\n        progress.style.visibility = 'hidden';\n        Notification.exception(e);\n        return pending.reject();\n    }\n    currentRequest = null;\n    return pending.resolve();\n};\n\nconst searchOnType = (e) => {\n    search(e.target.dataset.roleid, e.target.value);\n};\n\nconst searchOnSubmit = (e) => {\n    e.preventDefault();\n    const searchInput = e.target.querySelector('.quickfindlistsearch');\n    search(e.target.dataset.roleid, searchInput.value);\n};\n\nexport default {\n    init(instanceid) {\n        blockinstance = document.querySelector(`.block_quickfindlist[data-instance-id=\"${instanceid}\"]`);\n        blockinstance.querySelector('.quickfindlistsearch').addEventListener('keyup', searchOnType);\n        blockinstance.querySelector('form').addEventListener('submit', searchOnSubmit);\n    }\n};"],"names":["blockinstance","currentRequest","getUserPreferences","async","blockinstanceid","search","endpoint","request","Fetch","performGet","join","params","response","json","roleid","pending","Pending","progress","querySelector","style","visibility","results","dataset","instanceId","resolve","html","js","Templates","renderForPromise","replaceNode","e","exception","reject","searchOnType","target","value","searchOnSubmit","preventDefault","searchInput","init","instanceid","document","addEventListener"],"mappings":"2QAuBIA,cAEAC,mTAQSC,mBAAqBC,MAAMC,gBAAiBC,gBAC/CC,SAAW,CAACF,gBAAiB,SAC7BG,QAAUC,eAAMC,WAAW,sBAAuBH,SAASI,KAAK,KAAM,CAACC,OAAQ,CAACN,OAAAA,UACtFJ,eAAiBM,cACXK,eAAiBL,eACnBA,UAAYN,eAEL,KAEJW,SAASC,6DAGdR,OAASF,MAAMW,OAAQT,gBACnBU,QAAU,IAAIC,wCAAwBF,SACtCG,SAAWjB,cAAckB,cAAc,0BAEzCD,SAASE,MAAMC,WAAa,gBACtBC,cAAgBnB,mBAAmBF,cAAcsB,QAAQC,WAAYlB,YACtEgB,eACMN,QAAQS,gBAEbC,KAACA,KAADC,GAAOA,UAAYC,mBAAUC,iBAAiB,8BAA+BP,4BACzEQ,YAAY7B,cAAckB,cAAc,yBAA0BO,KAAMC,IAClFT,SAASE,MAAMC,WAAa,SAC9B,MAAOU,UACLb,SAASE,MAAMC,WAAa,+BACfW,UAAUD,GAChBf,QAAQiB,gBAEnB/B,eAAiB,KACVc,QAAQS,WAGbS,aAAgBH,IAClBzB,OAAOyB,EAAEI,OAAOZ,QAAQR,OAAQgB,EAAEI,OAAOC,QAGvCC,eAAkBN,IACpBA,EAAEO,uBACIC,YAAcR,EAAEI,OAAOhB,cAAc,wBAC3Cb,OAAOyB,EAAEI,OAAOZ,QAAQR,OAAQwB,YAAYH,qBAGjC,CACXI,KAAKC,YACDxC,cAAgByC,SAASvB,+DAAwDsB,kBACjFxC,cAAckB,cAAc,wBAAwBwB,iBAAiB,QAAST,cAC9EjC,cAAckB,cAAc,QAAQwB,iBAAiB,SAAUN"}